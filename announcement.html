<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Birthday Announcement</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to bottom, #ffecd2, #fcb69f);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      font-family: 'Pacifico', cursive;
      text-align: center;
      color: #ff4081;
      margin-top: 40px;
      font-size: 3rem;
      text-shadow: 2px 2px #fff;
    }

    .announcement-card {
      max-width: 600px;
      margin: 50px auto 20px auto;
      padding: 30px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      text-align: center;
      font-size: 1.2rem;
      color: #333;
      position: relative;
      z-index: 10;
    }

    .balloons {
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      top: 0;
      left: 0;
      z-index: 0;
    }

    .balloon {
      position: absolute;
      width: 60px;
      height: 80px;
      border-radius: 50% 50% 50% 50%;
      opacity: 0.9;
      animation: floatUp linear infinite;
    }

    .balloon:after {
      content: '';
      position: absolute;
      width: 2px;
      height: 40px;
      background: #555;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
    }

    @keyframes floatUp {
      0% { transform: translateY(100vh) translateX(0); }
      100% { transform: translateY(-150px) translateX(50px); }
    }

    .confetti {
      position: fixed;
      width: 100%;
      height: 100%;
      pointer-events: none;
      top: 0;
      left: 0;
      z-index: 9999;
    }

    #wishBtn {
      margin-top: 20px;
      padding: 12px 20px;
      border:none;
      border-radius:50px;
      background: linear-gradient(90deg,#ff9a9e,#fad0c4);
      color:white;
      font-weight:bold;
      cursor:pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      font-size: 1.1rem;
    }

    #wishBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #backBtn {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 10px 16px;
      border:none;
      border-radius:50px;
      background:#ff4081;
      color:white;
      font-weight:bold;
      cursor:pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index:10000;
    }
  </style>
</head>
<body>

  <h1>üéâ Happy Birthday! üéâ</h1>

  <div class="announcement-card">
    <p>We are excited to celebrate <strong>G.Yashwin Visakan the creator's</strong> birthday today! <strong>September 5 2025</strong> ü•≥</p>
    <p>Join us in wishing them lots of joy, cake, and fun! üç∞üéÅ</p>
    <button id="wishBtn">üéâ Wish (0)</button>
  </div>

  <div class="balloons"></div>
  <canvas class="confetti"></canvas>
  <button id="backBtn">‚¨Ö Back</button>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

const firebaseConfig = {
  apiKey: "AIzaSyAkUB8cH0kBTVf4jDmJvqe-ZiM0npDiaRU",
  authDomain: "chatbloom-70593.firebaseapp.com",
  projectId: "chatbloom-70593",
  storageBucket: "chatbloom-70593.firebasestorage.app",
  messagingSenderId: "761754714884",
  appId: "1:761754714884:web:343fb283e544628cc2c651",
  measurementId: "G-E30VD1GML1"
};



    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const wishBtn = document.getElementById('wishBtn');
    
    let userEmail = null;
    const backBtn = document.getElementById('backBtn');
    backBtn.addEventListener('click', ()=>{ window.history.back(); });

    onAuthStateChanged(auth, async user=>{
      if(user) userEmail = user.email;
      else userEmail = "guest@example.com"; // fallback

      const wishDoc = doc(db,'birthdays','2025-09-04'); // unique doc per birthday
      const docSnap = await getDoc(wishDoc);
      if(!docSnap.exists()){
        await setDoc(wishDoc,{count:0,wished:[]});
      }

      const data = (await getDoc(wishDoc)).data();
      wishBtn.textContent = `üéâ Wish (${data.count})`;

      if(data.wished.includes(userEmail)){
        wishBtn.disabled = true; // already wished
      }
    });

    wishBtn.addEventListener('click', async ()=>{
      if(!userEmail) return;

      const wishDoc = doc(db,'birthdays','2025-09-04');
      const docSnap = await getDoc(wishDoc);
      const data = docSnap.data();

      if(data.wished.includes(userEmail)){
        wishBtn.disabled = true;
        return;
      }

      await updateDoc(wishDoc,{
        count: increment(1),
        wished: [...data.wished, userEmail]
      });

      wishBtn.textContent = `üéâ Wish (${data.count+1})`;
      wishBtn.disabled = true;

      // Mini confetti burst
      const colors = ['#FF6384','#36A2EB','#FFCE56','#FF9A9E','#8E44AD','#2ECC71'];
      for(let i=0;i<15;i++){
        const c = document.createElement('div');
        c.style.position='fixed';
        c.style.width=c.style.height='8px';
        c.style.background=colors[Math.floor(Math.random()*colors.length)];
        c.style.left=(window.innerWidth*Math.random())+'px';
        c.style.top=(window.innerHeight*Math.random())+'px';
        c.style.borderRadius='50%';
        c.style.opacity=0.9;
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),1000);
      }
    });

    // Balloons
    const balloonsContainer = document.querySelector('.balloons');
    for(let i=0; i<20; i++){
      const balloon = document.createElement('div');
      balloon.className='balloon';
      balloon.style.background=['#FF6384','#36A2EB','#FFCE56','#FF9A9E','#8E44AD','#2ECC71'][Math.floor(Math.random()*6)];
      balloon.style.left=Math.random()*100+'vw';
      balloon.style.animationDuration=(5+Math.random()*5)+'s';
      balloonsContainer.appendChild(balloon);
    }

    // Confetti
    const canvas = document.querySelector('.confetti');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const confettiPieces = [];
    for(let i=0;i<150;i++){
      confettiPieces.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: Math.random()*6+2,
        d: Math.random()*150+50,
        color: ['#FF6384','#36A2EB','#FFCE56','#FF9A9E','#8E44AD','#2ECC71'][Math.floor(Math.random()*6)],
        tilt: Math.random()*10-10,
        tiltAngleIncremental: Math.random()*0.07+0.05,
        tiltAngle: 0
      });
    }

    function drawConfetti(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      confettiPieces.forEach((p)=>{
        ctx.beginPath();
        ctx.lineWidth=p.r;
        ctx.strokeStyle=p.color;
        ctx.moveTo(p.x + p.tilt + p.r/2, p.y);
        ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r/2);
        ctx.stroke();
        p.tiltAngle += p.tiltAngleIncremental;
        p.y += (Math.cos(p.d)+3+p.r/2)/2;
        p.tilt = Math.sin(p.tiltAngle)*15;
        if(p.y>canvas.height){p.y=-10;p.x=Math.random()*canvas.width;}
      });
      requestAnimationFrame(drawConfetti);
    }
    drawConfetti();
    window.addEventListener('resize', ()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});
  </script>

</body>
</html>
